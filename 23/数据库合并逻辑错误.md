# Detecting Logic Bugs of Join Optimizations in DBMS

+ 以前的研究（PQS）等对多表查询的覆盖率低

+ 多表查询本身的难点：

+ - 如何验证结果，差分测试或手动检查都存在问题，提出想要对任意查询都得到正确结果
  - 搜索空间，多表查询的搜索空间是指数级的，因此需要高效的搜索方法

针对上述两个问题，提出TQS（包含DSG和KQE）

对于DSG：
+ 先把大表按3NF范式拆成多个小表，为了便于后续合并回来，需要维护RowID，并在此基础上构造位图索引
  
+ 在小表中引入噪声，便于检测逻辑错误，为了一致性，同样在大表中更新这些错误，需要执行一些算法使得在主键和外键被污染后所有表依然能保证函数依赖成立

- 将小表之间的主外键关系画成一张模式图，通过在图上随机游走的方式来生成含有JOIN操作的AST，并进一步完善成最终的查询

- 最后，求ground truth是通过第一步中维护的位图索引间的运算，来求出参与连接的所有元组，最后通过RowID表复原即可

对于KQE

- 通过将DSG的模式图进行扩展，便可以通过判断子图同构的方式来判断生成的两个查询的相似程度
- 但是子图同构问题是NP问题，为了解决这个问题，它将所有的历史查询合成了一张高维的图GI，然后对两个点在图上进行类似最近邻算法（KNN）的方法，如果计算出的覆盖率大于某个阈值，就说明这两个查询是类似的，如果小于的话就没问题，代替了子图同构的问题。
- 上述方法只能用于比较两个路径间的相似度，实际上我们想要在扩展模式图上游走的过程中，通过一些算法来指导具体怎么走。他设计的算法是，当我们目前走到某个点时，先获取所有包含它相邻点的路径，并且比较这些路径各自和其他路径间的平均覆盖率，则走覆盖率越低的点的概率越大（意味着这条路径很新）
